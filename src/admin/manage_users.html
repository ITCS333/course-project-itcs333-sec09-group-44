<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Character encoding -->
    <meta charset="UTF-8" />

    <!-- Responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Page title -->
    <title>Admin Portal</title>

    <!-- CSS framework (Bootstrap) -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />

    <!-- Optional shared styles -->
    <link rel="stylesheet" href="../common/styles.css" />
    
    <script>
        // Immediately check if the user is authorized
        fetch('../auth/api/me.php')
            .then(response => response.json())
            .then(data => {
                // If not logged in OR not an admin, kick them out
                if (!data.logged_in || data.role !== 'admin') {
                    window.location.href = '../auth/login.html';
                }
            })
            .catch(err => {
                // If the check fails entirely, play it safe and redirect
                console.error("Auth check failed", err);
                window.location.href = '../auth/login.html';
            });
    </script>

    <script src="manage_users.js" defer></script>

    <!-- Admin script -->
    <script src="manage_users.js" defer></script>
</head>
<body class="bg-light">

    <!-- Header -->
   <header class="border-bottom bg-white py-3 mb-4 shadow-sm">
        <div class="container d-flex justify-content-between align-items-center">
            <!-- Main heading -->
            <h1 class="h3 mb-0 text-primary">Admin Portal</h1>
            <div>
                <a href="../../index.html" class="btn btn-outline-secondary btn-sm">
                    ← Back to Home
                </a>
                <!-- LOGOUT BUTTON ADDED -->
                <button id="logout-btn" class="btn btn-danger btn-sm ms-2"> Logout </button>
            </div>
        </div>
    </header>
    <!-- End header -->

    <!-- Main content -->
    <main class="container mb-5">

        <div class="row g-4">
            <!-- LEFT COLUMN: Password management -->
            <div class="col-lg-4">
                <section>
                    <h2 class="h4 mb-3">Change Your Password</h2>

                    <!-- Password form -->
                    <form id="password-form" action="#" class="card p-3 shadow-sm">
                        <fieldset>
                            <legend class="h6">Password Update</legend>

                            <div class="mb-3">
                                <label for="current-password" class="form-label">
                                    Current Password
                                </label>
                                <input
                                  type="password"
                                  id="current-password"
                                  class="form-control"
                                  required
                                />
                            </div>

                            <div class="mb-3">
                                <label for="new-password" class="form-label">
                                    New Password
                                </label>
                                <input
                                  type="password"
                                  id="new-password"
                                  class="form-control"
                                  minlength="8"
                                  required
                                />
                            </div>

                            <div class="mb-3">
                                <label for="confirm-password" class="form-label">
                                    Confirm New Password
                                </label>
                                <input
                                  type="password"
                                  id="confirm-password"
                                  class="form-control"
                                  required
                                />
                            </div>

                            <button
                              type="submit"
                              id="change"
                              class="btn btn-primary w-100"
                            >
                                Update Password
                            </button>
                        </fieldset>
                    </form>
                </section>
            </div>

            <!-- RIGHT COLUMN: Student management -->
            <div class="col-lg-8">
                <section>
                    <h2 class="h4 mb-3">Manage Students</h2>

                    <!-- Search -->
                    <div class="mb-3">
                        <label for="search-input" class="form-label">Search by name</label>
                        <input
                          type="text"
                          id="search-input"
                          class="form-control"
                          placeholder="Start typing a student name…"
                        />
                    </div>

                    <!-- Add new student form (collapsible) -->
                    <details class="mb-4 border rounded bg-white">
                        <summary class="px-3 py-2 fw-semibold">
                            Add New Student
                        </summary>

                        <form id="add-student-form" action="#" class="p-3 pt-2">
                            <fieldset>
                                <legend class="h6">New Student Information</legend>

                                <div class="mb-3">
                                    <label for="student-name" class="form-label">
                                        Full Name
                                    </label>
                                    <input
                                      type="text"
                                      id="student-name"
                                      class="form-control"
                                      required
                                    />
                                </div>

                                <div class="mb-3">
                                    <label for="student-id" class="form-label">
                                        Student ID
                                    </label>
                                    <input
                                      type="text"
                                      id="student-id"
                                      class="form-control"
                                      required
                                    />
                                </div>

                                <div class="mb-3">
                                    <label for="student-email" class="form-label">
                                        Email
                                    </label>
                                    <input
                                      type="email"
                                      id="student-email"
                                      class="form-control"
                                      required
                                    />
                                </div>

                                <div class="mb-3">
                                    <label for="default-password" class="form-label">
                                        Default Password
                                    </label>
                                    <input
                                      type="text"
                                      id="default-password"
                                      class="form-control"
                                      placeholder="password123"
                                    />
                                </div>

                                <button
                                  type="submit"
                                  id="add"
                                  class="btn btn-success"
                                >
                                    Add Student
                                </button>
                            </fieldset>
                        </form>
                    </details>

                    <!-- Student list -->
                    <h3 class="h5 mb-3">Registered Students</h3>

                    <div class="table-responsive">
                        <table
                          id="student-table"
                          class="table table-sm table-striped table-hover align-middle"
                        >
                            <thead class="table-light">
                                <tr>
                                    <th scope="col">Name</th>
                                    <th scope="col">Student ID</th>
                                    <th scope="col">Email</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- JS will render rows here -->
                                <tr>
                                    <td colspan="4" class="text-center text-muted">
                                        Loading students…
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js">
    </script>
</body>
</html>
